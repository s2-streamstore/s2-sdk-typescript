<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@s2-dev/streamstore - v0.19.1</title><meta name="description" content="Documentation for @s2-dev/streamstore"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">@s2-dev/streamstore - v0.19.1</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@s2-dev/streamstore - v0.19.1</h1></div><div class="tsd-panel tsd-typography"><div align="center">
  <p>
    <!-- Light mode logo -->
    <a href="https://s2.dev#gh-light-mode-only">
      <img src="https://raw.githubusercontent.com/s2-streamstore/s2-sdk-rust/main/assets/s2-black.png" height="60">
    </a>
    <!-- Dark mode logo -->
    <a href="https://s2.dev#gh-dark-mode-only">
      <img src="https://raw.githubusercontent.com/s2-streamstore/s2-sdk-rust/main/assets/s2-white.png" height="60">
    </a>
  </p>
  <h1>TypeScript SDK for S2</h1>
  <p>
    <!-- npm -->
    <a href="https://www.npmjs.com/package/@s2-dev/streamstore"><img src="https://img.shields.io/npm/v/@s2-dev/streamstore.svg" alt="npm version" /></a>
    <!-- Discord (chat) -->
    <a href="https://discord.gg/vTCs7kMkAf"><img src="https://img.shields.io/discord/1209937852528599092?logo=discord" /></a>
  </p>
</div>
<p><a href="https://s2.dev">S2</a> is a serverless data store for streams.</p>
<p>This repo is the official TypeScript SDK, which provides an ergonomic interface over the service's <a href="https://s2.dev/docs/rest/protocol">REST API</a>.</p>
<blockquote>
<p><strong>Note:</strong> This is a rewrite of the TypeScript SDK. The older version (0.15.3) is still available and can be installed:</p>
<pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">@s2-dev/streamstore@0.15.3</span>
</code><button type="button">Copy</button></pre>

<p>The archived repository for the older SDK is available <a href="https://github.com/s2-streamstore/s2-sdk-typescript-old">here</a>.</p>
</blockquote>
<h2 id="s2-basics" class="tsd-anchor-link">S2 Basics<a href="#s2-basics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>S2 is a managed service that provides unlimited, durable streams.</p>
<p>Streams can be appended to, with all new records added to the tail of the stream. You can read from any portion of a stream – indexing by record sequence number, or timestamp – and follow updates live.</p>
<p>See it in action on the playground (built with this TypeScript SDK): <a href="https://s2.dev/playground">s2.dev/playground</a>.</p>
<h2 id="sdk" class="tsd-anchor-link">SDK<a href="#sdk" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="getting-started" class="tsd-anchor-link">Getting started<a href="#getting-started" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li>
<p>Add the <code>@s2-dev/streamstore</code> dependency to your project:</p>
<pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">@s2-dev/streamstore</span><br/><span class="hl-3"># or</span><br/><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">@s2-dev/streamstore</span><br/><span class="hl-3"># or</span><br/><span class="hl-0">bun</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">@s2-dev/streamstore</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p>Generate an access token by logging onto the web console at
<a href="https://s2.dev/dashboard">s2.dev</a>.</p>
</li>
<li>
<p>Make a request using SDK client.</p>
<pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">S2</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@s2-dev/streamstore&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">s2</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">S2</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">accessToken:</span><span class="hl-1"> </span><span class="hl-5">process</span><span class="hl-1">.</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-7">S2_ACCESS_TOKEN</span><span class="hl-1">!,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">basins</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">s2</span><span class="hl-1">.</span><span class="hl-5">basins</span><span class="hl-1">.</span><span class="hl-0">list</span><span class="hl-1">();</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;My basins:&quot;</span><span class="hl-1">, </span><span class="hl-5">basins</span><span class="hl-1">.</span><span class="hl-5">basins</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-5">basin</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">basin</span><span class="hl-1">.</span><span class="hl-5">name</span><span class="hl-1">));</span>
</code><button type="button">Copy</button></pre>

</li>
</ol>
<h3 id="configuration-and-retries" class="tsd-anchor-link">Configuration and retries<a href="#configuration-and-retries" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>S2</code> client and stream sessions support configurable retry behavior:</p>
<ul>
<li>
<p>Configure global retry behavior when constructing <code>S2</code>:</p>
<pre><code class="ts"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">S2</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@s2-dev/streamstore&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">s2</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">S2</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">accessToken:</span><span class="hl-1"> </span><span class="hl-5">process</span><span class="hl-1">.</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-7">S2_ACCESS_TOKEN</span><span class="hl-1">!,</span><br/><span class="hl-1">  </span><span class="hl-5">retry:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">// Total attempts including the first call (1 = no retries)</span><br/><span class="hl-1">    </span><span class="hl-5">maxAttempts:</span><span class="hl-1"> </span><span class="hl-8">3</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">// Base delay (ms) between attempts; jitter is applied</span><br/><span class="hl-1">    </span><span class="hl-5">retryBackoffDurationMillis:</span><span class="hl-1"> </span><span class="hl-8">100</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">// Retry policy for append operations (default: &quot;all&quot;; see API docs for details)</span><br/><span class="hl-1">    </span><span class="hl-5">appendRetryPolicy:</span><span class="hl-1"> </span><span class="hl-2">&quot;all&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">// Maximum time (ms) to wait for an append ack before treating it as failed</span><br/><span class="hl-1">    </span><span class="hl-5">requestTimeoutMillis:</span><span class="hl-1"> </span><span class="hl-8">5000</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</li>
<li>
<p>Stream append/read sessions created from <code>S2.basin(...).stream(...)</code> inherit this retry configuration.</p>
</li>
<li>
<p>The <code>appendRetryPolicy</code> dictates how failed appends should be retried. If you are not using a concurrency control like <code>match_seq_num</code>, then retrying a failed append could result in duplicate data, depending on the nature of the failure. This policy can be set to tolerate potential duplicates by retrying all failures (<code>&quot;all&quot;</code>, the default) or only failures guaranteed not to have had a side effect (<code>&quot;noSideEffects&quot;</code>). If you cannot tolerate potential duplicates and do not have explicit deduplication downstream, consider using <code>&quot;noSideEffects&quot;</code> instead of the default.</p>
</li>
</ul>
<p>See the generated API docs for the full description of <code>RetryConfig</code>, <code>AppendRetryPolicy</code> and <code>AppendSessionOptions</code>.</p>
<h3 id="append-sessions" class="tsd-anchor-link">Append sessions<a href="#append-sessions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>AppendSession</code> represents a session for appending batches of records to a stream. There are two ways of interacting with an append session:</p>
<ul>
<li>via <code>submit(...)</code>, which returns a <code>Promise&lt;AppendAck&gt;</code> that resolves when the batch is acknowledged by S2.</li>
<li>via the session's <code>.readable</code> and <code>.writable</code> streams (<code>ReadableStream&lt;AppendAck&gt;</code> / <code>WritableStream&lt;AppendArgs&gt;</code>).</li>
</ul>
<p>You obtain an append session from a stream via:</p>
<pre><code class="ts"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">session</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">stream</span><span class="hl-1">.</span><span class="hl-0">appendSession</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>All batches submitted to the same append session will be made durable in the same order as they are submitted, regardless of which method is used. Batches <em>can</em> be duplicated, however, depending on the <code>appendRetryPolicy</code> used.</p>
<h4 id="transports" class="tsd-anchor-link">Transports<a href="#transports" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The append session supports two transports:</p>
<ul>
<li>One based on <code>fetch</code></li>
<li>Another which uses our custom <a href="https://s2.dev/docs/rest/records/overview#s2s-spec"><code>s2s</code> protocol</a> over HTTP/2.</li>
</ul>
<p>When possible, the <code>s2s</code> protocol is preferred as it allows for safe pipelining of concurrent appends over the same session, while still enforcing ordering across batches. This can't be guaranteed with the <code>fetch</code>-based transport, so it will not pipeline writes (effectively meaning there can only be one inflight, unacknowledged append at a time, thus limiting throughput).</p>
<p>This SDK will attempt to detect whether <code>s2s</code> can be used (if the runtime has <code>node:http2</code> support), and select a transport accordingly. The transport detection also be overridden via the <code>forceTransport</code> option when creating a stream client:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">stream</span><span class="hl-1"> = </span><span class="hl-5">s2</span><br/><span class="hl-1">    .</span><span class="hl-0">basin</span><span class="hl-1">(</span><span class="hl-2">&quot;my-basin&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-0">stream</span><span class="hl-1">(</span><span class="hl-2">&quot;my-stream&quot;</span><span class="hl-1">, { </span><span class="hl-5">forceTransport:</span><span class="hl-1"> </span><span class="hl-2">&quot;fetch&quot;</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<h4 id="backpressure" class="tsd-anchor-link">Backpressure<a href="#backpressure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Only writing via <code>WritableStream</code> reflects backpressure. A <code>write(...)</code> call will resolve as soon as the batch is enqueued for transmission, and will block until there is capacity.</p>
<p>Enqueuing a batch means that the session has accepted the batch, and that it is now inflight. It <em>doesn't</em> mean that the batch has been acknowledged by S2. Because of this, if using <code>WritableStream</code>, you should also make sure to <code>close()</code> the session, as otherwise you may miss a failure. Only after closing the writer without error can the upstream contents be considered to have been safely appended to the stream.</p>
<p>The <code>AppendSession</code> controls how many batches can be inflight at a given time, which is the origin of backpressure. This can be configured by setting either <code>maxInflightBatches</code> or <code>maxInflightBytes</code> on <code>AppendSessionOptions</code>. Writes will block until there is capacity, thus exerting backpressure on upstream writers.</p>
<h2 id="examples" class="tsd-anchor-link">Examples<a href="#examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This repo is a small monorepo with:</p>
<ul>
<li>Core SDK package: <code>@s2-dev/streamstore</code> in <code>packages/streamstore</code></li>
<li>Optional patterns package: <code>@s2-dev/streamstore-patterns</code> in <code>packages/patterns</code></li>
</ul>
<p>Core SDK examples live under:</p>
<ul>
<li><a href="https://github.com/s2-streamstore/s2-sdk-typescript/tree/main/packages/streamstore/examples"><code>packages/streamstore/examples</code></a></li>
</ul>
<p>Run a core example with:</p>
<pre><code class="bash"><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-5">S2_ACCESS_TOKEN</span><span class="hl-1">=</span><span class="hl-2">&quot;&lt;YOUR ACCESS TOKEN&gt;&quot;</span><br/><span class="hl-0">npx</span><span class="hl-1"> </span><span class="hl-2">tsx</span><span class="hl-1"> </span><span class="hl-2">packages/streamstore/examples/</span><span class="hl-1">&lt;</span><span class="hl-2">example_nam</span><span class="hl-1">e&gt;</span><span class="hl-2">.ts</span>
</code><button type="button">Copy</button></pre>

<p>Patterns-specific examples (serialization pipeline, typed client, etc.) live under:</p>
<ul>
<li><a href="https://github.com/s2-streamstore/s2-sdk-typescript/tree/main/packages/patterns/examples"><code>packages/patterns/examples</code></a></li>
</ul>
<p>To use those, first install the optional patterns package alongside the core SDK and then follow the instructions in:</p>
<ul>
<li><a href="https://github.com/s2-streamstore/s2-sdk-typescript/tree/main/packages/patterns/README.md"><code>packages/patterns/README.md</code></a></li>
</ul>
<h3 id="example-appending-and-reading-data" class="tsd-anchor-link">Example: Appending and Reading Data<a href="#example-appending-and-reading-data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">S2</span><span class="hl-1">, </span><span class="hl-5">AppendRecord</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@s2-dev/streamstore&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">s2</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">S2</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">accessToken:</span><span class="hl-1"> </span><span class="hl-5">process</span><span class="hl-1">.</span><span class="hl-5">env</span><span class="hl-1">.</span><span class="hl-7">S2_ACCESS_TOKEN</span><span class="hl-1">!,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Get a basin and stream</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">basin</span><span class="hl-1"> = </span><span class="hl-5">s2</span><span class="hl-1">.</span><span class="hl-0">basin</span><span class="hl-1">(</span><span class="hl-2">&quot;my-basin&quot;</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">stream</span><span class="hl-1"> = </span><span class="hl-5">basin</span><span class="hl-1">.</span><span class="hl-0">stream</span><span class="hl-1">(</span><span class="hl-2">&quot;my-stream&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Append records</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">stream</span><span class="hl-1">.</span><span class="hl-0">append</span><span class="hl-1">([</span><br/><span class="hl-1">  </span><span class="hl-5">AppendRecord</span><span class="hl-1">.</span><span class="hl-0">make</span><span class="hl-1">(</span><span class="hl-2">&quot;Hello, world!&quot;</span><span class="hl-1">, { </span><span class="hl-5">foo:</span><span class="hl-1"> </span><span class="hl-2">&quot;bar&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">  </span><span class="hl-5">AppendRecord</span><span class="hl-1">.</span><span class="hl-0">make</span><span class="hl-1">(</span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Uint8Array</span><span class="hl-1">([</span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-8">2</span><span class="hl-1">, </span><span class="hl-8">3</span><span class="hl-1">]), { </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&quot;binary&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">]);</span><br/><br/><span class="hl-3">// Read records</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">stream</span><span class="hl-1">.</span><span class="hl-0">read</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">seq_num:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">count:</span><span class="hl-1"> </span><span class="hl-8">10</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">for</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">record</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">records</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Record:&quot;</span><span class="hl-1">, </span><span class="hl-5">record</span><span class="hl-1">.</span><span class="hl-5">body</span><span class="hl-1">, </span><span class="hl-2">&quot;Headers:&quot;</span><span class="hl-1">, </span><span class="hl-5">record</span><span class="hl-1">.</span><span class="hl-5">headers</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">// Stream records with read session</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">readSession</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">stream</span><span class="hl-1">.</span><span class="hl-0">readSession</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">clamp:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">tail_offset:</span><span class="hl-1"> </span><span class="hl-8">10</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">for</span><span class="hl-1"> </span><span class="hl-4">await</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">record</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-5">readSession</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Streaming record:&quot;</span><span class="hl-1">, </span><span class="hl-5">record</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<blockquote>
<p>You might want to update the basin name in the examples before running since
basin names are globally unique and each example uses the same basin name
(<code>&quot;my-favorite-basin&quot;</code>).</p>
</blockquote>
<h2 id="patterns" class="tsd-anchor-link">Patterns<a href="#patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This repo also contains a package of more opinionated patterns and types for building around S2. This is available as <code>@s2-dev/streamstore-patterns</code>, and located in <code>packages/patterns</code>.</p>
<p>See the <a href="media/patterns">README</a> in the package for more, as well as examples of how to create a typed client for use with AI SDK.</p>
<pre><code class="typescript"><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-9">AiStreamChunk</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-5">role</span><span class="hl-1">: </span><span class="hl-2">&quot;assistant&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">content</span><span class="hl-1">: </span><span class="hl-9">string</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">s2</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">S2</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-5">accessToken:</span><span class="hl-1"> </span><span class="hl-5">s2AccessToken</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">retry:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-5">maxAttempts:</span><span class="hl-1"> </span><span class="hl-8">10</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">retryBackoffDurationMillis:</span><span class="hl-1"> </span><span class="hl-8">100</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">appendRetryPolicy:</span><span class="hl-1"> </span><span class="hl-2">&quot;all&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Create the raw append session.</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">appendSession</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">s2</span><br/><span class="hl-1">    .</span><span class="hl-0">basin</span><span class="hl-1">(</span><span class="hl-2">&quot;mega-corp-agent-sessions&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-0">stream</span><span class="hl-1">(</span><span class="hl-2">&quot;session/09b5fb6&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-0">appendSession</span><span class="hl-1">();</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">textEncoder</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">TextEncoder</span><span class="hl-1">();</span><br/><br/><span class="hl-3">// Use the serializing append session wrapper to add framing,</span><br/><span class="hl-3">// type serialization, and deduplication logic.</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">appender</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SerializingAppendSession</span><span class="hl-1">&lt;</span><span class="hl-9">AiStreamChunk</span><span class="hl-1">&gt;(</span><br/><span class="hl-1">    </span><span class="hl-5">appendSession</span><span class="hl-1">,</span><br/><span class="hl-1">    (</span><span class="hl-5">msg</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">textEncoder</span><span class="hl-1">.</span><span class="hl-0">encode</span><span class="hl-1">(</span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-5">msg</span><span class="hl-1">)),</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-3">// Get a stream of tokens from AI SDK.</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">modelStream</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">streamText</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-5">model:</span><span class="hl-1"> </span><span class="hl-0">openai</span><span class="hl-1">(</span><span class="hl-2">&quot;gpt-4o-mini&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-5">prompt:</span><span class="hl-1"> </span><span class="hl-2">&quot;Tell me who has the most beautiful durable stream API in the land.&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">// Tee the stream, using one for processing and sending the</span><br/><span class="hl-3">// other to S2.</span><br/><span class="hl-6">let</span><span class="hl-1"> [</span><span class="hl-5">forUI</span><span class="hl-1">, </span><span class="hl-5">forS2</span><span class="hl-1">] = </span><span class="hl-5">modelStream</span><span class="hl-1">.</span><span class="hl-5">textStream</span><br/><span class="hl-1">    .</span><span class="hl-0">pipeThrough</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">TransformStream</span><span class="hl-1">&lt;</span><span class="hl-9">string</span><span class="hl-1">, </span><span class="hl-9">AiStreamChunk</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">            </span><span class="hl-0">transform</span><span class="hl-5">:</span><span class="hl-1"> (</span><span class="hl-5">text</span><span class="hl-1">, </span><span class="hl-5">controller</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-5">controller</span><span class="hl-1">.</span><span class="hl-0">enqueue</span><span class="hl-1">({</span><br/><span class="hl-1">                    </span><span class="hl-5">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;assistant&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">                    </span><span class="hl-5">content:</span><span class="hl-1"> </span><span class="hl-5">text</span><span class="hl-1">,</span><br/><span class="hl-1">                });</span><br/><span class="hl-1">            },</span><br/><span class="hl-1">        }),</span><br/><span class="hl-1">    )</span><br/><span class="hl-1">    .</span><span class="hl-0">tee</span><span class="hl-1">();</span><br/><br/><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-5">s2Pipe</span><span class="hl-1"> = </span><span class="hl-5">forS2</span><span class="hl-1">.</span><span class="hl-0">pipeTo</span><span class="hl-1">(</span><span class="hl-5">appender</span><span class="hl-1">);</span><br/><br/><span class="hl-4">for</span><span class="hl-1"> </span><span class="hl-4">await</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">msg</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-5">forUI</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">// Send messages to your UI.</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-5">msg</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">// Ensure the stream is fully saved in S2.</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">s2Pipe</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<h2 id="sdk-docs-and-reference" class="tsd-anchor-link">SDK Docs and Reference<a href="#sdk-docs-and-reference" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>For detailed documentation for the SDK, please check the generated type docs <a href="https://s2-streamstore.github.io/s2-sdk-typescript/">here</a>.</p>
<p>For API reference, please visit the <a href="https://s2.dev/docs">S2 Documentation</a>.</p>
<h2 id="feedback" class="tsd-anchor-link">Feedback<a href="#feedback" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>We use <a href="https://github.com/s2-streamstore/s2-sdk-typescript/issues">Github Issues</a> to
track feature requests and issues with the SDK. If you wish to provide feedback,
report a bug or request a feature, feel free to open a Github issue.</p>
<h3 id="contributing" class="tsd-anchor-link">Contributing<a href="#contributing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Developers are welcome to submit Pull Requests on the repository. If there is
no tracking issue for the bug or feature request corresponding to the PR, we
encourage you to open one for discussion before submitting the PR.</p>
<h2 id="reach-out-to-us" class="tsd-anchor-link">Reach out to us<a href="#reach-out-to-us" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Join our <a href="https://discord.gg/vTCs7kMkAf">Discord</a> server. We would love to hear
from you.</p>
<p>You can also email us at <a href="mailto:hi@s2.dev">hi@s2.dev</a>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#s2-basics"><span>S2 <wbr/>Basics</span></a><a href="#sdk"><span>SDK</span></a><ul><li><a href="#getting-started"><span>Getting started</span></a></li><li><a href="#configuration-and-retries"><span>Configuration and retries</span></a></li><li><a href="#append-sessions"><span>Append sessions</span></a></li><li><ul><li><a href="#transports"><span>Transports</span></a></li><li><a href="#backpressure"><span>Backpressure</span></a></li></ul></li></ul><a href="#examples"><span>Examples</span></a><ul><li><a href="#example-appending-and-reading-data"><span>Example: <wbr/>Appending and <wbr/>Reading <wbr/>Data</span></a></li></ul><a href="#patterns"><span>Patterns</span></a><a href="#sdk-docs-and-reference"><span>SDK <wbr/>Docs and <wbr/>Reference</span></a><a href="#feedback"><span>Feedback</span></a><ul><li><a href="#contributing"><span>Contributing</span></a></li></ul><a href="#reach-out-to-us"><span>Reach out to us</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">@s2-dev/streamstore - v0.19.1</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
